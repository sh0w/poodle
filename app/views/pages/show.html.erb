 <section class="intro" class="course_overview">
  <header>
   <h1>
     <%= @page.lesson.title %>
   </h1>
  </header>
  <div class="intro_content">
    <% @page.resources.each do |resource| %>
      <div class = "resource" id="resource_<%= resource.id %>">
        <% if resource.text %>
          <h2><%= resource.headline %></h2>
          <p><%= resource.text.text %></p>
        <% end %>
        <% if resource.link %>
          <h2><%= resource.headline %></h2> 
          <a href ="<%= resource.link.link %>">-> <%= resource.link.link %></a>
        <% end %>
        <% if resource.image %>
          <h2><%= resource.headline %></h2>
          <br />
          <%= image_tag resource.image.image.url(:medium) %> 
        <% end %>
        <% if resource.upload %>
          <h2><%= resource.headline %></h2>
          <a href ="<%= resource.upload.upload.url %>">-> <%= resource.upload.upload_file_name %></a> 
        <% end %>
        <% if resource.video %>
          <h2><%= resource.headline %></h2>
          <iframe width="420" height="315" src="https://www.youtube.com/embed/<%= resource.video.video %>?rel=0" frameborder="0" allowfullscreen></iframe>
        <% end %>
      </div>
    <% end %>
    <% page_position = @page.position %>
    <% lesson_position = @page.lesson.position %>
    <% if @page.lesson.pages.find_by_position(page_position - 1) %>
      <% previous_page_id = @page.lesson.pages.find_by_position(page_position - 1).id %>
      <%= link_to "previous page", "/courses/#{@course.slug}/lessons/#{@page.lesson.id}/pages/#{previous_page_id}" %>
    <% end %>
    <% if @page.lesson.pages.find_by_position(page_position + 1) %>
      <% next_page_id = @page.lesson.pages.find_by_position(page_position + 1).id %>
      <%= link_to "next page", "/courses/#{@course.slug}/lessons/#{@page.lesson.id}/pages/#{next_page_id}" %>
    <% else %>
      Lesson finished!
      <% if @page.lesson.course.lessons.find_by_position(lesson_position + 1) %>
        <% next_lesson_id = @page.lesson.course.lessons.find_by_position(lesson_position + 1).id %>
        <% next_page_id = @page.lesson.course.lessons.find_by_position(lesson_position + 1).pages.first.id %>
        <%= link_to "start next lesson", "/courses/#{@course.slug}/lessons/#{next_lesson_id}/pages/#{next_page_id}" %>
      <% else %>
        Course finished!
      <% end %>
    <% end %>
    <br />
    <%= link_to "back to course overview", "/courses/#{@course.slug}" %>
  </div>
   </section>


 <hr />
 <h1 class="main">Comments</h1>
 <hr />
 <section id="commentbox" class="clearfix">
   <div id = "comments">
     <% @comments.each do |comment| %>
         <%= render :partial => "shared/comment", :object => comment %>
     <% end %>
   </div>
   <% if user_signed_in? %>
       <div class="comment new">
         <div class="form"></div>
         <div class="comment_content">
           <%= link_to 'New Comment', {:controller => "comments", :action => "new",:course_id => @course.slug, :page_id => @page.id }, id: "new_comment_link", remote: true %>
         </div>
       </div>
   <% end %>

 </section>
